"""
Sets up the terminal color scheme.
"""

<<<<<<< HEAD
import os
import sys

from django.utils import lru_cache, termcolors
=======
import functools
import os
import sys

from django.utils import termcolors
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc


def supports_color():
    """
<<<<<<< HEAD
    Returns True if the running system's terminal supports color,
=======
    Return True if the running system's terminal supports color,
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
    and False otherwise.
    """
    plat = sys.platform
    supported_platform = plat != 'Pocket PC' and (plat != 'win32' or 'ANSICON' in os.environ)

    # isatty is not always implemented, #6223.
    is_a_tty = hasattr(sys.stdout, 'isatty') and sys.stdout.isatty()
<<<<<<< HEAD
    if not supported_platform or not is_a_tty:
        return False
    return True


class Style(object):
=======
    return supported_platform and is_a_tty


class Style:
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
    pass


def make_style(config_string=''):
    """
    Create a Style object from the given config_string.

    If config_string is empty django.utils.termcolors.DEFAULT_PALETTE is used.
    """

    style = Style()

    color_settings = termcolors.parse_color_setting(config_string)

    # The nocolor palette has all available roles.
    # Use that palette as the basis for populating
    # the palette as defined in the environment.
    for role in termcolors.PALETTES[termcolors.NOCOLOR_PALETTE]:
        if color_settings:
            format = color_settings.get(role, {})
            style_func = termcolors.make_style(**format)
        else:
            def style_func(x):
                return x
        setattr(style, role, style_func)

    # For backwards compatibility,
    # set style for ERROR_OUTPUT == ERROR
    style.ERROR_OUTPUT = style.ERROR

    return style


<<<<<<< HEAD
@lru_cache.lru_cache(maxsize=None)
def no_style():
    """
    Returns a Style object with no color scheme.
=======
@functools.lru_cache(maxsize=None)
def no_style():
    """
    Return a Style object with no color scheme.
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
    """
    return make_style('nocolor')


<<<<<<< HEAD
def color_style():
    """
    Returns a Style object from the Django color scheme.
    """
    if not supports_color():
=======
def color_style(force_color=False):
    """
    Return a Style object from the Django color scheme.
    """
    if not force_color and not supports_color():
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
        return no_style()
    return make_style(os.environ.get('DJANGO_COLORS', ''))

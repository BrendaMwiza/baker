import fnmatch
import os

from django.conf import settings
from django.core.exceptions import ImproperlyConfigured


def matches_patterns(path, patterns=None):
    """
    Return True or False depending on whether the ``path`` should be
    ignored (if it matches any pattern in ``ignore_patterns``).
    """
<<<<<<< HEAD
    if patterns is None:
        patterns = []
    for pattern in patterns:
        if fnmatch.fnmatchcase(path, pattern):
            return True
    return False
=======
    return any(fnmatch.fnmatchcase(path, pattern) for pattern in (patterns or []))
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc


def get_files(storage, ignore_patterns=None, location=''):
    """
    Recursively walk the storage directories yielding the paths
    of all files that should be copied.
    """
    if ignore_patterns is None:
        ignore_patterns = []
    directories, files = storage.listdir(location)
    for fn in files:
<<<<<<< HEAD
=======
        # Match only the basename.
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
        if matches_patterns(fn, ignore_patterns):
            continue
        if location:
            fn = os.path.join(location, fn)
<<<<<<< HEAD
=======
            # Match the full file path.
            if matches_patterns(fn, ignore_patterns):
                continue
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
        yield fn
    for dir in directories:
        if matches_patterns(dir, ignore_patterns):
            continue
        if location:
            dir = os.path.join(location, dir)
<<<<<<< HEAD
        for fn in get_files(storage, ignore_patterns, dir):
            yield fn
=======
        yield from get_files(storage, ignore_patterns, dir)
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc


def check_settings(base_url=None):
    """
<<<<<<< HEAD
    Checks if the staticfiles settings have sane values.
=======
    Check if the staticfiles settings have sane values.
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
    """
    if base_url is None:
        base_url = settings.STATIC_URL
    if not base_url:
        raise ImproperlyConfigured(
            "You're using the staticfiles app "
            "without having set the required STATIC_URL setting.")
    if settings.MEDIA_URL == base_url:
        raise ImproperlyConfigured("The MEDIA_URL and STATIC_URL "
                                   "settings must have different values")
<<<<<<< HEAD
=======
    if (settings.DEBUG and settings.MEDIA_URL and settings.STATIC_URL and
            settings.MEDIA_URL.startswith(settings.STATIC_URL)):
        raise ImproperlyConfigured(
            "runserver can't serve media if MEDIA_URL is within STATIC_URL."
        )
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
    if ((settings.MEDIA_ROOT and settings.STATIC_ROOT) and
            (settings.MEDIA_ROOT == settings.STATIC_ROOT)):
        raise ImproperlyConfigured("The MEDIA_ROOT and STATIC_ROOT "
                                   "settings must have different values")

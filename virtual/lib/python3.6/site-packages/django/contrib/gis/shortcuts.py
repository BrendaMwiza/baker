import zipfile
from io import BytesIO

from django.conf import settings
from django.http import HttpResponse
from django.template import loader

# NumPy supported?
try:
    import numpy
except ImportError:
    numpy = False


def compress_kml(kml):
<<<<<<< HEAD
    "Returns compressed KMZ from the given KML string."
=======
    "Return compressed KMZ from the given KML string."
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
    kmz = BytesIO()
    with zipfile.ZipFile(kmz, 'a', zipfile.ZIP_DEFLATED) as zf:
        zf.writestr('doc.kml', kml.encode(settings.DEFAULT_CHARSET))
    kmz.seek(0)
    return kmz.read()


def render_to_kml(*args, **kwargs):
<<<<<<< HEAD
    "Renders the response as KML (using the correct MIME type)."
=======
    "Render the response as KML (using the correct MIME type)."
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
    return HttpResponse(
        loader.render_to_string(*args, **kwargs),
        content_type='application/vnd.google-earth.kml+xml',
    )


def render_to_kmz(*args, **kwargs):
    """
<<<<<<< HEAD
    Compresses the KML content and returns as KMZ (using the correct
=======
    Compress the KML content and return as KMZ (using the correct
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
    MIME type).
    """
    return HttpResponse(
        compress_kml(loader.render_to_string(*args, **kwargs)),
        content_type='application/vnd.google-earth.kmz',
    )
<<<<<<< HEAD


def render_to_text(*args, **kwargs):
    "Renders the response using the MIME type for plain text."
    return HttpResponse(loader.render_to_string(*args, **kwargs), content_type='text/plain')
=======
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc

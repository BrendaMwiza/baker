<<<<<<< HEAD
import os
=======
import functools
from pathlib import Path
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc

from django.conf import settings
from django.template.backends.django import DjangoTemplates
from django.template.loader import get_template
<<<<<<< HEAD
from django.utils import lru_cache
from django.utils._os import upath
=======
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
from django.utils.functional import cached_property
from django.utils.module_loading import import_string

try:
    from django.template.backends.jinja2 import Jinja2
except ImportError:
    def Jinja2(params):
        raise ImportError("jinja2 isn't installed")

<<<<<<< HEAD
ROOT = upath(os.path.dirname(__file__))


@lru_cache.lru_cache()
=======
ROOT = Path(__file__).parent


@functools.lru_cache()
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
def get_default_renderer():
    renderer_class = import_string(settings.FORM_RENDERER)
    return renderer_class()


<<<<<<< HEAD
class BaseRenderer(object):
=======
class BaseRenderer:
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
    def get_template(self, template_name):
        raise NotImplementedError('subclasses must implement get_template()')

    def render(self, template_name, context, request=None):
        template = self.get_template(template_name)
        return template.render(context, request=request).strip()


<<<<<<< HEAD
class EngineMixin(object):
=======
class EngineMixin:
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
    def get_template(self, template_name):
        return self.engine.get_template(template_name)

    @cached_property
    def engine(self):
        return self.backend({
            'APP_DIRS': True,
<<<<<<< HEAD
            'DIRS': [os.path.join(ROOT, self.backend.app_dirname)],
=======
            'DIRS': [str(ROOT / self.backend.app_dirname)],
>>>>>>> a49b7d6bd2068c3888052b51a1a4869cb0918bdc
            'NAME': 'djangoforms',
            'OPTIONS': {},
        })


class DjangoTemplates(EngineMixin, BaseRenderer):
    """
    Load Django templates from the built-in widget templates in
    django/forms/templates and from apps' 'templates' directory.
    """
    backend = DjangoTemplates


class Jinja2(EngineMixin, BaseRenderer):
    """
    Load Jinja2 templates from the built-in widget templates in
    django/forms/jinja2 and from apps' 'jinja2' directory.
    """
    backend = Jinja2


class TemplatesSetting(BaseRenderer):
    """
    Load templates using template.loader.get_template() which is configured
    based on settings.TEMPLATES.
    """
    def get_template(self, template_name):
        return get_template(template_name)
